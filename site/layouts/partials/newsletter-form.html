<form name = "mailingList" data-netlify="true" class="flex-ns mb3">

  <fieldset class="flex-auto mb2 mb0-ns mr2-ns" name="newsletter" >
    <input type="text" id="email" placeholder="Your email" class="w-100">
    <label for="email">Your email</label>
  </fieldset>

  <button id="submitButton" class="btn mb3 w-100 w-auto-ns mb0-ns raise" type="submit">Submit</button>

 

</form>

<script src="https://apis.google.com/js/api.js" async></script>
<script>
  const submitButton = document.getElementById("submitButton");
  
  
  const regex = /^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/; 

  submitButton.addEventListener('click',(e) => {
    e.preventDefault();
    //Check for valid mail
    if(regex.test(document.getElementById("email").value)){
      alert("Submitting...");
      setTimeout(() => {alert("Thanks for signing up!")},1000);
    }
  });
  let initialize = () => {
    //Load google api
    gapi.load('client',() => {
      gapi.client.init({
      'apiKey': 'AIzaSyD3y84uEN1nJ1UCPOjPbn9x4ZNv1xsbmBg',
      'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/translate/v2/rest'],
      'clientId': '423818341208-q4832cba0c4k64antf5ji9cg8tq3ss31.apps.googleusercontent.com',
      'scope': 'profile'
      }).then(() =>{
        let userMail = document.getElementById("email");
        const url = `google.com/m8/feeds/contacts/${userMail}/full`;
        // gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
        // updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        return gapi.client.request({
          'path': url
        })
      }).then(res => {
          console.log(res);
          alert(`Thanks, you've been added to our mailing list!`);
      })
        .catch(e => console.log(e));
    })
    
  }
/*
  let updateSigninStatus = (isSignedIn) => {
    if(isSignedIn) makeApiCall(); 
  }

  let makeApiCall = () => {
    let userMail = document.getElementById("email");
    const url = `www.google.com/m8/feeds/contacts/${userMail}/full`;
    return fetch(url,{
      method: "POST"
    })
    .then(response => console.log(response))
    .catch(e => console.log(e));
  }*/
</script>
