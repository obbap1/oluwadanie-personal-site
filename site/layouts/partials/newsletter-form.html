<style>
  .loading {
  position: fixed;
  z-index: 999;
  height: 2em;
  width: 2em;
  overflow: show;
  margin: auto;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  visibility: hidden;
}

/* Transparent Overlay */
.loading:before {
  content: '';
  display: block;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.3);
}

/* :not(:required) hides these rules from IE9 and below */
.loading:not(:required) {
  /* hide "loading..." text */
  font: 0/0 a;
  color: transparent;
  text-shadow: none;
  background-color: transparent;
  border: 0;
}

.loading:not(:required):after {
  content: '';
  display: block;
  font-size: 10px;
  width: 1em;
  height: 1em;
  margin-top: -0.5em;
  -webkit-animation: spinner 1500ms infinite linear;
  -moz-animation: spinner 1500ms infinite linear;
  -ms-animation: spinner 1500ms infinite linear;
  -o-animation: spinner 1500ms infinite linear;
  animation: spinner 1500ms infinite linear;
  border-radius: 0.5em;
  -webkit-box-shadow: rgba(0, 0, 0, 0.75) 1.5em 0 0 0, rgba(0, 0, 0, 0.75) 1.1em 1.1em 0 0, rgba(0, 0, 0, 0.75) 0 1.5em 0 0, rgba(0, 0, 0, 0.75) -1.1em 1.1em 0 0, rgba(0, 0, 0, 0.5) -1.5em 0 0 0, rgba(0, 0, 0, 0.5) -1.1em -1.1em 0 0, rgba(0, 0, 0, 0.75) 0 -1.5em 0 0, rgba(0, 0, 0, 0.75) 1.1em -1.1em 0 0;
  box-shadow: rgba(0, 0, 0, 0.75) 1.5em 0 0 0, rgba(0, 0, 0, 0.75) 1.1em 1.1em 0 0, rgba(0, 0, 0, 0.75) 0 1.5em 0 0, rgba(0, 0, 0, 0.75) -1.1em 1.1em 0 0, rgba(0, 0, 0, 0.75) -1.5em 0 0 0, rgba(0, 0, 0, 0.75) -1.1em -1.1em 0 0, rgba(0, 0, 0, 0.75) 0 -1.5em 0 0, rgba(0, 0, 0, 0.75) 1.1em -1.1em 0 0;
}

/* Animation */

@-webkit-keyframes spinner {
  0% {
    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -ms-transform: rotate(0deg);
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
@-moz-keyframes spinner {
  0% {
    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -ms-transform: rotate(0deg);
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
@-o-keyframes spinner {
  0% {
    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -ms-transform: rotate(0deg);
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
@keyframes spinner {
  0% {
    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -ms-transform: rotate(0deg);
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}

</style>

<div id="loading">

</div>

<form name = "mailingList" data-netlify="true" class="flex-ns mb3" netlify>

  <fieldset class="flex-auto mb2 mb0-ns mr2-ns" name="newsletter" >
    <input type="text" id="email" placeholder="Your email" class="w-100">
    <label for="email">Your email</label>
  </fieldset>

  <button id="submitButton" class="btn mb3 w-100 w-auto-ns mb0-ns raise" type="submit">Submit</button>

 

</form>

<script src="https://apis.google.com/js/api.js" async></script>
<script>
  const submitButton = document.getElementById("submitButton");
  
  const regex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;

  const loadingDiv = document.getElementById('loading');

  function showSpinner() {
    loadingDiv.style.visibility = 'visible';
  }

  function hideSpinner() {
    loadingDiv.style.visibility = 'hidden';
  }

  submitButton.addEventListener('click',(e) => {
    //e.preventDefault();
    showSpinner();
    //Check for valid mail
    if(regex.test(document.getElementById("email").value)){
      initialize();
     
    }
  });
  let initialize = () => {
    //Load google api
    gapi.load('client',() => {
      gapi.client.init({
      'apiKey': 'AIzaSyD3y84uEN1nJ1UCPOjPbn9x4ZNv1xsbmBg',
      'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/translate/v2/rest'],
      'clientId': '423818341208-q4832cba0c4k64antf5ji9cg8tq3ss31.apps.googleusercontent.com',
      'scope': 'profile'
      }).then(() =>{
        let userMail = document.getElementById("email");
        const url = `google.com/m8/feeds/contacts/${userMail}/full`;
        // gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
        // updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        return gapi.client.request({
          'path': url
        })
      }).then(res => {
          console.log(res);
          alert(`Thanks, you've been added to our mailing list!`);
      })
        .catch(e =>{ 
          //alert(`Thanks, you've been added to our mailing list!`);
          console.log(e)});
    })
    
  }
/*
  let updateSigninStatus = (isSignedIn) => {
    if(isSignedIn) makeApiCall(); 
  }

  let makeApiCall = () => {
    let userMail = document.getElementById("email");
    const url = `www.google.com/m8/feeds/contacts/${userMail}/full`;
    return fetch(url,{
      method: "POST"
    })
    .then(response => console.log(response))
    .catch(e => console.log(e));
  }*/
</script>
